generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model admin_pricing {
  id           Int      @id @default(autoincrement())
  service_name String   @db.VarChar(255)
  service_id   String   @unique(map: "service_id") @db.VarChar(50)
  price        Decimal  @db.Decimal(10, 2)
  description  String?  @db.Text
  updated_by   Int?
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @default(now()) @db.Timestamp(0)
  users        users?   @relation(fields: [updated_by], references: [id], onUpdate: Restrict, map: "admin_pricing_ibfk_1")

  @@index([service_id], map: "idx_service_id")
  @@index([updated_by], map: "updated_by")
}

model delivery {
  id               Int                       @id @default(autoincrement())
  order_id         Int
  delivery_method  delivery_delivery_method? @default(Pickup)
  shipping_address String?                   @db.Text
  estimated_delivery DateTime?               @db.DateTime(0)
  actual_delivery  DateTime?                 @db.DateTime(0)
  delivery_cost    Decimal?                  @db.Decimal(10, 2)
  status           delivery_status?          @default(Pending)
  tracking_number  String?                   @db.VarChar(100)
  created_at       DateTime                  @default(now()) @db.Timestamp(0)
  updated_at       DateTime                  @default(now()) @db.Timestamp(0)
  orders           orders                    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "delivery_ibfk_1")

  @@index([order_id], map: "idx_order_id")
  @@index([status], map: "idx_status")
}

model order_items {
  id             Int      @id @default(autoincrement())
  order_id       Int
  service_id     Int
  quantity       Int      @default(1)
  unit_price     Decimal  @db.Decimal(10, 2)
  total_price    Decimal  @db.Decimal(12, 2)
  specifications String?  @db.LongText
  created_at     DateTime @default(now()) @db.Timestamp(0)
  orders         orders   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "order_items_ibfk_1")
  services       services @relation(fields: [service_id], references: [id], onUpdate: Restrict, map: "order_items_ibfk_2")

  @@index([order_id], map: "idx_order_id")
  @@index([service_id], map: "idx_service_id")
}

model orders {
  id             Int                    @id @default(autoincrement())
  order_id       String                 @unique(map: "order_id") @db.VarChar(50)
  user_id        Int
  order_date     DateTime?              @default(now()) @db.DateTime(0)
  required_date  DateTime?              @db.DateTime(0)
  shipped_date   DateTime?              @db.DateTime(0)
  status         orders_status?         @default(Menunggu)
  total_amount   Decimal                @db.Decimal(12, 2)
  payment_status orders_payment_status? @default(Pending)
  payment_method String?                @db.VarChar(50)
  notes          String?                @db.Text
  
  // --- KOLOM BARU UNTUK MENYIMPAN FILE UPLOAD ---
  file_url       String?                @db.Text 
  
  created_at     DateTime               @default(now()) @db.Timestamp(0)
  updated_at     DateTime               @default(now()) @db.Timestamp(0)
  delivery       delivery[]
  order_items    order_items[]
  users          users                  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "orders_ibfk_1")
  payments       payments[]
  reviews        reviews[]

  @@index([order_date], map: "idx_order_date")
  @@index([payment_status], map: "idx_payment_status")
  @@index([status], map: "idx_status")
  @@index([user_id], map: "idx_user_id")
}

model payments {
  id              Int              @id @default(autoincrement())
  order_id        Int
  user_id         Int
  amount          Decimal          @db.Decimal(12, 2)
  payment_method  String           @db.VarChar(50)
  payment_gateway String?          @db.VarChar(50)
  transaction_id  String?          @unique(map: "transaction_id") @db.VarChar(100)
  status          payments_status? @default(Pending)
  payment_date    DateTime?        @db.DateTime(0)
  notes           String?          @db.Text
  created_at      DateTime         @default(now()) @db.Timestamp(0)
  updated_at      DateTime         @default(now()) @db.Timestamp(0)
  orders          orders           @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "payments_ibfk_1")
  users           users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "payments_ibfk_2")

  @@index([order_id], map: "idx_order_id")
  @@index([status], map: "idx_status")
  @@index([transaction_id], map: "idx_transaction_id")
  @@index([user_id], map: "idx_user_id")
}

model pricing {
  id               Int      @id @default(autoincrement())
  service_id       Int
  base_price       Decimal  @db.Decimal(10, 2)
  min_quantity     Int?     @default(1)
  max_quantity     Int?
  discount_percent Decimal? @default(0.00) @db.Decimal(5, 2)
  effective_price  Decimal? @db.Decimal(10, 2)
  is_active        Boolean? @default(true)
  created_at       DateTime @default(now()) @db.Timestamp(0)
  updated_at       DateTime @default(now()) @db.Timestamp(0)
  services         services @relation(fields: [service_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "pricing_ibfk_1")

  @@index([service_id], map: "idx_service_id")
}

model reviews {
  id         Int      @id @default(autoincrement())
  order_id   Int
  user_id    Int
  rating     Int?
  comment    String?  @db.Text
  created_at DateTime @default(now()) @db.Timestamp(0)
  updated_at DateTime @default(now()) @db.Timestamp(0)
  orders     orders   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "reviews_ibfk_1")
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "reviews_ibfk_2")

  @@index([order_id], map: "idx_order_id")
  @@index([rating], map: "idx_rating")
  @@index([user_id], map: "idx_user_id")
}

model services {
  id          Int                @id @default(autoincrement())
  name        String             @db.VarChar(255)
  description String?            @db.Text
  price       Decimal            @db.Decimal(10, 2)
  category    services_category? @default(lainnya)
  is_active   Boolean?           @default(true)
  created_at  DateTime           @default(now()) @db.Timestamp(0)
  updated_at  DateTime           @default(now()) @db.Timestamp(0)
  order_items order_items[]
  pricing     pricing[]

  @@index([category], map: "idx_category")
}

model users {
  id            Int             @id @default(autoincrement())
  name          String          @db.VarChar(255)
  email         String          @unique(map: "email") @db.VarChar(255)
  password      String          @db.VarChar(255)
  role          users_role?     @default(user)
  phone         String?         @db.VarChar(20)
  address       String?         @db.Text
  city          String?         @db.VarChar(100)
  created_at    DateTime        @default(now()) @db.Timestamp(0)
  updated_at    DateTime        @default(now()) @db.Timestamp(0)
  is_active     Boolean?        @default(true)
  admin_pricing admin_pricing[]
  orders        orders[]
  payments      payments[]
  reviews       reviews[]

  @@index([email], map: "idx_email")
  @@index([role], map: "idx_role")
}

enum delivery_delivery_method {
  Pickup
  Delivery
}

enum services_category {
  kertas
  warna
  ukuran
  finishing
  lainnya
}

enum users_role {
  user
  admin
}

enum orders_status {
  Menunggu
  Diproses
  Selesai
  Dibatalkan
}

enum delivery_status {
  Pending
  On_Way    @map("On Way")
  Delivered
  Returned
}

enum payments_status {
  Pending
  Success
  Failed
  Cancelled
}

enum orders_payment_status {
  Pending
  Paid
  Failed
}